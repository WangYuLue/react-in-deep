## 从零构建一个简单的 react

这篇文章会带领读者从零构建一个简单的 react，一共大概 300 行代码。其中包含了 react 的核心理念，例如：fibers、hooks、reconciliation。

这边文章专注实现 **React的方法组件** ，所以没有 Class组件相关的实现代码。

从头开始，以下是我们逐一添加到 React 版本中的所有内容：

- 第一步: createElement Function
- 第二步: render Function 渲染函数
- 第三步: Concurrent Mode 并发模式
- 第四步: Fibers
- 第五步: Render and Commit 阶段
- 第六步: Reconciliation 调和
- 第七步: Function Components 函数组件
- 第八步: Hooks

### 第一步、先谈谈 JSX

众所周知，`React` 的一大特色是 `JSX` 语法，它本质上是一个语法糖，类似 `XML` 的风格让 `JSX` 拥有更丰富的表现力。

例如下面的代码：

```tsx
const element = <div title='foo'>Hello</div>

// 等同于

const element = React.createElement(
  'div',
  { title: 'foo' },
  'Hello'
)
```

再查看一个嵌套的例子：


```tsx
const element = (<div title='foo'>
  <span id='a'>hello</span>
  <span id='b'>world</span>
</div>)

// 等同于

const element = React.createElement(
  'div',
  { title: 'foo' },
  React.createElement(
    'span',
    { id: 'a' },
    'hello'
  ),
  React.createElement(
    'span',
    { id: 'b' },
    'world'
  )
);
```

可以看到与使用原生 JS 相比， `JSX` 的表达更加简约直接，上面的例子可以直接运行，查看如下代码：

```ts
import React from 'react';
import ReactDOM from 'react-dom';

const element = React.createElement(
  'div',
  { title: 'foo' },
  React.createElement(
    'span',
    { id: 'a' },
    'hello'
  ),
  React.createElement(
    'span',
    { id: 'b' },
    'world'
  )
);

const container = document.getElementById('root');
ReactDOM.render(element, container);
```

运行 `yarn demo01` 可以查看效果。

解析 `JSX` 不在这篇文章要将的范畴，在我们创建的 React中，会借助类似 `babel` 这样的转换工具帮我们转换 `JSX`。

### 第二步、实现 createElement 方法

上面我们谈论 `JSX` 的时候，我们用到了 `React.createElement` 方法，它是干什么的呢？

我们在 **第一步** 的例子中打印个日志看一下它的数据结构，如下图：


### 相关链接

[Build your own React](https://pomb.us/build-your-own-react/)
[react-fiber-architecture](https://github.com/acdlite/react-fiber-architecture)
[React docs](https://zh-hans.reactjs.org/docs/reconciliation.html)
[烤透 React Hook](https://juejin.im/post/6867745889184972814)